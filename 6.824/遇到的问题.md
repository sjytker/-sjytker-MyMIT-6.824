



## json.NewEncoder 无法写入文件

**解决**：

​	struct 可导出性的问题，必须 uppercase 开头的变量才是可导出的，才能被写入 json 文件





## rpc 调用找不到 master 的函数

**问题**：

​	我在 master 写了 2 个 rpc 调用函数，其中一个能正常调用。另一个报错找不到该方法。调用方式完全一致，并且 master 也确定有 worker 调用的同名函数。

​	（搞了半天才找到问题）

**解决**：

​	还是 Golang exported 类型的问题。无论是 type，还是参数，都只有 uppercase 开头才是 exported，否则 unexported。

​	在 unexported 的情况下，文件不能写入，rpc 也无法调用。





## Mutex 的问题

**问题***：

​	习惯了 Java 的可重入锁，没意识到 golang 的 mutex 是不可重入的





## 共享变量问题

由于每个 Raft 对象既发送，又接收，它的对象变量是共享的，所有访问到共享变量的函数都应该加锁。否则会出现并发问题。



## Election 忙等

​	一开始我用 waitGroup（效果与 Java CountDownLatch 相同）等待所有 server 返回 RequestVote 结果。忽略了如果此时有 server down 无法选出 leader 的问题。

​	加上 time.Timer 来计时，timeout 则退出





## TestB 偶尔出现 apply error

- 这个错误捣鼓了几天。有时出现 apply error，有时又能 pass all test
- 最大的困难是，问题不可重现。多个测试函数都有概率出现。
- 把在测试代码中打印出所有 server 的 log

